# Документация проекта «Анализ отзывов»

## Общая информация

**Проект:** Анализ отзывов пользователей по темам и сентименту
**Технологии:** Python 3.12, FastAPI, Uvicorn, scikit-learn, SentenceTransformers, HTML/CSS/JS
**Запуск:**

```bash
python -m uvicorn main:app --reload
```

Проект позволяет загружать JSON-файл с текстами отзывов, автоматически анализировать их по темам и сентименту, строить статистику и визуализировать результаты.

---

## Используемые модели

1. **Topic model** (`model.pkl`) — модель для предсказания темы текста.
2. **Vectorizer** (`vectorizer.pkl`) — мешок слов для преобразования текста перед предсказанием сентимента.
3. **Sentiment classifier** (`model_clf.pkl`) — классификатор сентимента текста.
4. **SentenceTransformer** (`distiluse-base-multilingual-cased-v2`) — модель для получения эмбеддингов текста, используется для fallback-тем, если ключевые слова не сработали.

---

## API

### 1. Главная страница

**Endpoint:** `/`
**Метод:** `GET`
**Описание:** Возвращает HTML-интерфейс с возможностью загрузки данных, фильтровки и отображения результатов анализа.

---

### 2. Загрузка и анализ файла

**Endpoint:** `/analyze-file`
**Метод:** `POST`
**Параметры:**

* `file: UploadFile` — JSON-файл с данными.
  Формат файла:

  ```json
  {
    "data": [
        {"text": "Пример отзыва 1"},
        {"text": "Пример отзыва 2"}
    ]
  }
  ```

**Ответ:**

* `{"status": "ok"}` — успешный анализ
* `{"error": "<описание ошибки>"}` — при ошибке загрузки или анализа

---

### 3. Получение данных с фильтрацией

**Endpoint:** `/get-data`
**Метод:** `GET`
**Query-параметры:**

* `topic` — фильтр по теме (по умолчанию пусто = все темы)
* `sentiment` — фильтр по сентименту (по умолчанию пусто = все)

**Пример запроса:**

```
/get-data?topic=Карты&sentiment=positive
```

**Ответ:**

```json
{
  "predictions": [
    {
      "id": 1,
      "text": "Пример отзыва",
      "topics": ["Карты"],
      "sentiments": ["positive"],
      "sentiment_prob": {"positive": 0.85, "negative": 0.1, "neutral": 0.05}
    }
  ],
  "stats": {"positive": 1},
  "all_topics": ["Карты", "Мобильное приложение", ...],
  "all_sentiments": ["positive", "negative", "neutral"]
}
```

---

## Вспомогательные функции

### assign_multilabels(text: str)

* Назначает тексту список тем по ключевым словам.
* Если ключевых слов не найдено, возвращает `["general"]`.

### ml_predict(text: str, idx: int, top_n=3)

* Возвращает словарь с:

  * `id` — уникальный номер отзыва
  * `text` — исходный текст
  * `topics` — список тем
  * `sentiments` — список сентиментов
  * `sentiment_prob` — вероятности каждого сентимента
* Использует ключевые слова и fallback на нейронную модель для предсказания тем.

---

## Интерфейс пользователя

* **Загрузка данных** — кнопка для загрузки JSON-файла с отзывами.
* **Фильтры** — выпадающие списки для фильтрации по теме и сентименту.
* **Результаты анализа** — таблица с ID, темами и сентиментами.
* **Диаграмма** — круговая диаграмма распределения сентиментов и текстовая статистика.

---

## Запуск проекта
Если заходить через нашу публичную ссылку:
К сожалению у меня произошел форсмажор. Весь проект мы сделали(всё в github), но у меня отключили интернет, а прошлый хостинг лёг, так что ссылка на прототип будет работать лишь пару часов. В случае если вы зашли и она не работает- пишите мне в телеграмм @Mihail_o_o . Простите за такие траблы :(

https://f321-50-7-40-177.ngrok-free.app


Если локально:
1. Активировать виртуальное окружение:

```bash
.venv1\Scripts\activate
```

2. Установить зависимости:

```bash
pip install -r requirements.txt
```



3. Запустить сервер:

```bash
python -m uvicorn main:app --reload
```

4. Перейти в браузере по адресу:

```
http://127.0.0.1:8000/
```



